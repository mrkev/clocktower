<!doctype html>
<html>
  <head>
    <title>Tower</title>

    <!-- 1. Load platform.js for polyfill support. -->
    <script src="/bower_components/platform/platform.js"></script>
    <script src="//code.jquery.com/jquery-2.1.1.js"></script>
    <script src="/bower_components/jquery-ui/jquery-ui.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.21/angular.min.js"></script>
    <script src="/bower_components/angular-local-storage/angular-local-storage.min.js"></script>

    <link rel="import"
          href="/bower_components/polymer-ui-field/polymer-ui-field.html">
    <link rel="import" 
          href="/bower_components/polymer-ui-icon/polymer-ui-icon.html">

    <link rel="import"
          href="/bower_components/paper-button/paper-button.html">
    <link rel="import" 
          href="/bower_components/paper-dialog/paper-dialog-transition.html">
    <link rel="import"
          href="/bower_components/paper-dialog/paper-dialog.html">

    <link rel="stylesheet" href="/bower_components/normalize-css/normalize.css">
    <link rel="stylesheet" href="css/main.css">

  </head>
  <body unresolved ng-app="Tower">
  
      <div class="horizontal-container" start-justified horizontal ng-controller="AppController as app">

        <div class="card" ng-controller="SearchController as soyuz"> <!-- yuri  -->
          <div class="card_content" layout vertical>
            <form id="search_form" ng-submit="doSearch()">
              <polymer-ui-field>
                <polymer-ui-icon icon="search" ></polymer-ui-icon>
                <input placeholder="Search" flex  ng-model="searchText">
                <polymer-ui-icon icon="dialog"></polymer-ui-icon>
              </polymer-ui-field>

              <select name="term" hidden          ng-model="searchTerm">
                <option value="FA14">Fall 2014</option>
              </select>
            </form>


            <ul id="search_results" class="striped_list src_list" flex>

              <li 
                ng-repeat="result in model.searchResults track by $index">
                <span 
                  ng-bind-html="result.display_html">
                </span> 
                <button
                  ng-show='currentCalendar.courses[result.course.course_id] === undefined' 
                  ng-click='addCourse(result.course)'> +
                </button>
              </li>

            </ul> 
          </div>
        </div>



        <!-- 

        Middle Card. The Calendar.

        -->

        <div class="card wide" 
          ng-controller="CalendarController as vladimirovna" ng-init="initCalendar()">
          <div class="card_content" layout horizontal>
            
            <div class="sidebar">
              Edit: <input type="checkbox" ng-model="app._app.editCalendar">



              <!-- List of courses in the current calendar -->
              <ul id="calendar_courses" class="striped_list src_list">
                
                <li 
                  ng-repeat="course in model.calendars[model.term].courses"
                  style="border-left-color: {{getBorderColor(course.sections[0]);}}">

                  <span ng-if="willQueryInfo(course)">
                    Loading course...
                  </span>

                  <span ng-if="!willQueryInfo(course)">
                    {{course.subject_key}} {{course.catalog_number}} 
                  </span>
                  
                  <span flex></span>

                  <button 
                    ng-click="removeCourse(course)"
                    ng-show="app._app.editCalendar"
                    >-</button> <!-- Button to remove. Shown on edit mode -->
                  
                  <div ng-hide='app._app.editCalendar'>
                    <button 
                      ng-hide  ="isSelectedCourse(course)"
                      ng-click ="selectCourse(course)">[ ]</button>

                    <button
                      ng-show  ="isSelectedCourse(course)"
                      ng-click ="unselectCourse(course)">[x]</button>
                  </div>
                </li>

              </ul>
            </div>
            

            <!-- Acutal calendar. -->
            <div id="lolcalendar" flex>
              <style>
                
                #lolcalendar {
                  background: #eee;
                  position: relative;
                  overflow: scroll;
                }


                .gathering {
                  position: absolute;
                  cursor: pointer;
                  padding: 6px 12px 6px 12px;
                  text-align: center;
                  box-sizing: border-box;
                  border-radius: 2px;
                  border-width: 1px;
                  border-style: solid;
                  font-size: 10px;
                }

                .selected.oneof .gathering:hover  {
                    border: 2px solid gray;
                    padding: 5px 11px 5px 11px;
                }

                .selected .gathering{
                  background: white;
                  font-weight: bold;
                }

                .section {
                  width : 0px;
                  height: 0px;
                  position: absolute;
                }

                .calendar_background {
                  position: absolute;
                  width: 100%;
                  margin: 0px;
                  padding: 0px;
                }

                .calendar_background li {
                  list-style-type: none;
                  height: 58px;
                  width: 100%;
                  text-align: right;
                  padding: 12px 36px 12px 36px;
                  box-sizing: border-box;
                }


                .draggable {
                  z-index: 1;
                }

                .droppable {
                  font-style: italic;
                  border: 1px dashed gray;
                }



              </style>

              <ul class='striped_list calendar_background'>
                <li>0</li>
                <li>1</li>
                <li>2</li>
                <li>3</li>
                <li>4</li>
                <li>5</li>
                <li>6</li>
                <li>7</li>
                <li>8</li>
                <li>9</li>
                <li>10</li>
                <li>11</li>
                <li>12</li>
                <li>13</li>
                <li>14</li>
                <li>15</li>
                <li>16</li>
                <li>17</li>
                <li>18</li>
                <li>19</li>
                <li>20</li>
                <li>21</li>
                <li>22</li>
                <li>23</li>
              </ul>

              <div ng-repeat="course in model.calendars[model.term].selectedCourses">

                  <span if-show="!willQueryInfo(course)">
                    <div 
                      class="section" 
                      ng-hide="willQueryInfo(course) || 
                              (!isSelectedSection(section) && 
                               !isDraggingCompatibleSection(section))"
                      ng-repeat="section in course.sections"
                      ng-class="{selected: isSelectedSection(section),
                                 oneof : ssrCompenentsOfType(course, section.ssr_component) > 1}">

                      <div 
                        ng-repeat="weekday in section.meeting.meeting_pattern"
                        class = "gathering"
                        data-section="{{section}}"
                        ng-class = "{'draggable' :  isSelectedSection(section),
                                     'droppable' : !isSelectedSection(section)}"
                        
                        style ="width  : {{getWidth()}}px;
                                height : {{getHeight(section.meeting.start_time, section.meeting.end_time)}}px;
                                left   : {{getLeft(weekday)}}px;
                                top    : {{getTop(section.meeting.start_time)}}px;

                                background-color: {{getBackgroundColor(section)}};
                                border-color: {{getBorderColor(section)}};"
                        
                        on-finish-render>

                      {{course.subject_key}} {{course.catalog_number}} {{section.ssr_component}} <br/>
                      {{section.meeting.start_time}} - {{section.meeting.end_time}} <br/>
                      {{section.class_number}}

                      </div>
                    </div>
                  </span>
              </div>
            </div>

          </div>
        </div>


        <!-- Last Card: User information -->

        <div class="card">
          <div class="card_content" layout vertical>
            <span>
             
              I'll manage the data myself: 
              <input type="checkbox" ng-model="_app.saveToText"> <br/>

              <span ng-show='_app.saveToText'>
                <paper-button 
                  ng-show="_app.saveToText"
                  label="Load or save data" 
                  onclick="toggleDialog('paper-dialog-transition-center')">
                </paper-button>
                <br/>
              </span>

              Save and load to this browser: 
              <input 
                type="checkbox" 
                ng-model="_app.saveToBrowser"
                ng-change="changeSaveToBrowser(_app.saveToBrowser)"
              ><br/>



              I'll login. Store my stuff there: <input type="checkbox" ng-model="_app.saveToLogin" disabled> <br/>
            </span>
            

            <paper-dialog heading="This is your data." transition="paper-dialog-transition-center">

              <p>To save your calendars just copy it to a safe place. To load previous
                calendars just paste it here. <strong>This will override everything
                currently in the application.</strong></p> <br/>
              
              <textarea
                class="data"
                ng-model="savedata"
                flex></textarea>

              <paper-button label="Cancel" affirmative></paper-button>
              <paper-button 
                label="Done" 
                ng-click="loadData(savedata)"
                affirmative 
                autofocus>
              </paper-button>

            </paper-dialog>
            
            
            <script>
              function toggleDialog(transition) {
                var dialog = document.querySelector('paper-dialog[transition=' + transition + ']');
                dialog.toggle();
              }              
            </script>

            <script>
              //$(function() {
              //  $(".draggable").draggable({
              //    revert: "valid"
              //  });
              //  $(".draggable2").draggable({
              //    revert: "invalid"
              //  });
  
              //  $(".droppable").droppable({
              //    activeClass: "ui-state-default",
              //    hoverClass: "ui-state-hover",
              //    drop: function(event, ui) {
              //      console.log('hi')
              //    }
              //  });
  
              //  $("#lolcalendar").on("mousedown", ".gathering", function(event) {
              //    console.log('attatch')
              //    return true;
              //    //$(this).draggable();
              //  });
  
              //});
            </script>
          </div>
        </div>

      </div>
    </div>

    <script src="js/tower.js"></script>
    <script src="js/calendar.js"></script>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/bower_components/datejs/build/date.js"></script>
    <script src="/bower_components/spectrajs/spectra.min.js"></script>

    <script src="js/app.js"></script>
    <script src-"js/services.js"></script>
    <script src="js/SearchController.js"></script>
    <script src="js/index.js" defer></script>

  </body>
</html>