<!doctype html>
<html>
  <head>
    <title>Tower</title>

    <link rel="stylesheet" href="/bower_components/normalize-css/normalize.css">
    <link rel="stylesheet" href="css/main.css">

    <!-- 1. Load platform.js for polyfill support. -->
    <script src="/bower_components/platform/platform.js"></script>
    <script src="/bower_components/jquery/dist/jquery.min.js"></script>
    <script src="/bower_components/jquery-ui/jquery-ui.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.21/angular.min.js"></script>
    <script src="/bower_components/angular-local-storage/angular-local-storage.min.js"></script>

    <link rel="import"
          href="/bower_components/polymer-ui-field/polymer-ui-field.html">
    <link rel="import" 
          href="/bower_components/polymer-ui-icon/polymer-ui-icon.html">
    <link rel="import" 
          href="/bower_components/polymer-ui-accordion/polymer-ui-accordion.html">


    <link rel="import"
          href="/bower_components/paper-button/paper-button.html">
    <link rel="import" 
          href="/bower_components/paper-dialog/paper-dialog-transition.html">
    <link rel="import"
          href="/bower_components/paper-dialog/paper-dialog.html">

  </head>
  <body unresolved ng-app="Tower">
  
      <div class="horizontal-container" start-justified horizontal ng-controller="AppController as app">

        <div class="card" ng-controller="SearchController as soyuz"> <!-- yuri  -->
          <div class="card_content" layout vertical>
            <form id="search_form" ng-submit="doSearch()">
              <polymer-ui-field>
                <polymer-ui-icon icon="search" ></polymer-ui-icon>
                <input placeholder="Search" flex  ng-model="searchText">
                <polymer-ui-icon icon="dialog"></polymer-ui-icon>
              </polymer-ui-field>

              <select name="term" hidden          ng-model="searchTerm">
                <option value="FA14">Fall 2014</option>
              </select>
            </form>

            <polymer-ui-accordion selected="0" flex>
              <polymer-ui-collapsible ng-repeat="result in model.searchResults track by $index">
                
                <div class="polymer-ui-collapsible-header">
                  <span ng-bind-html="result.display_html"></span>

                  <button
                    ng-show='currentCalendar.courses[result.course.course_id] === undefined' 
                    ng-click='addCourse(result.course, $event);'> +
                  </button>
                </div>

                <div class="content">
                  {{result.course.units}} units.<br/>
                  <p ng-if="result.course.crosslists.length > 0">
                    Crosslisted as 
                    <span ng-repeat="crosslist in result.course.crosslists">
                      {{crosslist.subject_key}} {{crosslist.catalog_number}}
                    </span>
                  </p>
                  <p ng-if="result.course.comeetings.length > 0">
                    Comeets with
                    <span ng-repeat="comeeting in result.course.comeetings">
                      {{comeeting.subject_key}} {{comeeting.catalog_number}}
                    </span>
                  </p>
                  
                  {{result.course.sections.length}} sections. <br/>
                  <ul>
                    <li ng-repeat="section in result.course.sections"> {{section.ssr_component}} </li>
                  </ul>

                  Grading basis {{result.course.grading_basis}} <br/>
                  <!-- {{result.course | json}} -->
                  <p ng-if=""></p>
                </div>
              </polymer-ui-collapsible>
            </polymer-ui-accordion>
            <style>

            polymer-ui-accordion {
              overflow: scroll;
            }

            polymer-ui-accordion .content {
              white-space: normal;
              padding : 6px 12px;
              border-top: solid 1px #eee;
              margin-top: 3px;
            }
            polymer-ui-accordion polymer-ui-collapsible:nth-child(odd) {
              background: #f5f5f5;
            }

            polymer-ui-accordion polymer-ui-collapsible:nth-child(odd) .content {
              border-top: solid 1px white;

            }


            polymer-ui-accordion polymer-ui-collapsible  {
              padding: 6px 12px; 
            }


            .polymer-ui-collapsible-header {

              margin-bottom: 3px;
              margin-top: 3px;

              /* layout horizontal */
              -ms-flex-direction: row;
              -webkit-flex-direction: row;
              flex-direction: row;
              display: -ms-flexbox;
              display: -webkit-flex;
              display: flex;
            }

            .detail {
              margin: 3px 8px 0px 6px;
              color: #DDD;
              mar
            }
            

            .polymer-ui-collapsible-header span {
              overflow: hidden;
              text-overflow: ellipsis;
              
               /*flex*/ 
              -ms-flex: 1;
              -webkit-flex: 1;
              flex: 1;
            }

            </style>
          </div>
        </div>



        <!-- 

        Middle Card. The Calendar.

        -->

        <div class="card wide" 
          ng-controller="CalendarController as vladimirovna" ng-init="initCalendar()">
          <div class="card_content" layout horizontal>
            

            <!-- Sidebar -->
            <div class="sidebar" layout vertical>
              Edit: <input type="checkbox" ng-model="app._app.editCalendar">


              <ul id="calendar_courses" class="striped_list src_list" flex>
                
                <li 
                  ng-repeat="course in model.calendars[model.term].courses"
                  style="border-left-color: {{getBorderColor(course.sections[0]);}}">

                  <span ng-if="willQueryInfo(course)">
                    Loading course...
                  </span>

                  <span ng-if="!willQueryInfo(course)">
                    {{course.subject_key}} {{course.catalog_number}} 
                  </span>
                  
                  <span flex></span>

                  <div class="detail">{{course.units}}</div>

                  <button 
                    ng-click="removeCourse(course)"
                    ng-show="app._app.editCalendar"
                    >-</button> <!-- Button to remove. Shown on edit mode -->
                  
                  <div ng-hide='app._app.editCalendar'>
                    <button 
                      ng-hide  ="isSelectedCourse(course)"
                      ng-click ="selectCourse(course)">[ ]</button>

                    <button
                      ng-show  ="isSelectedCourse(course)"
                      ng-click ="unselectCourse(course)">[x]</button>
                  </div>
                </li>

              </ul>

              <style>
              .center {
                text-align: center;
              }
              .big {
                font-size: 2.5em;
              }
              .small {
                font-size: 0.9em;
                color: #222;
              }
              </style>
              <div class="center">
                <span class='big'>{{model.units()}}</span>
                <br/><span classs='small'>units.</span>
              </div>
            </div>
            

            <!-- Acutal calendar. -->
            <div id="lolcalendar" flex>
              <ul class='striped_list calendar_background'>
                <li>0</li>
                <li>1</li>
                <li>2</li>
                <li>3</li>
                <li>4</li>
                <li>5</li>
                <li>6</li>
                <li>7</li>
                <li>8</li>
                <li>9</li>
                <li>10</li>
                <li>11</li>
                <li>12</li>
                <li>13</li>
                <li>14</li>
                <li>15</li>
                <li>16</li>
                <li>17</li>
                <li>18</li>
                <li>19</li>
                <li>20</li>
                <li>21</li>
                <li>22</li>
                <li>23</li>
              </ul>
              <style>
                .colliding {
                  font-family: monospace;
                }
              </style>



              <div ng-repeat="course in model.calendars[model.term].selectedCourses">

                <span if-show="!willQueryInfo(course)">
                    
                  <div 
                    class="section" 
                    ng-hide="willQueryInfo(course) || 
                            (!isSelectedSection(section) && 
                             !isDraggingCompatibleSection(section))"
                    ng-repeat="section in course.sections"
                    ng-class="{selected: isSelectedSection(section),
                               oneof : ssrCompenentsOfType(course, section.ssr_component) > 1,
                               colliding : isColliding(section)}" on-finish-render>

                    <div 
                        ng-repeat="weekday in section.meeting.meeting_pattern"
                        class = "gathering"
                        data-section="{{section}}"
                        ng-class = "{'draggable' :  isSelectedSection(section),
                                     'droppable' : !isSelectedSection(section)}"
                        
                        style ="width  : {{getWidth(section)}}px;
                                height : {{getHeight(section.meeting.start_time, section.meeting.end_time)}}px;
                                left   : {{getLeft(weekday)}}px;
                                top    : {{getTop(section.meeting.start_time)}}px;

                                background-color: {{getBackgroundColor(section)}};
                                border-color: {{getBorderColor(section)}};">

                    {{course.subject_key}} <strong>{{course.catalog_number}}</strong> {{section.ssr_component}} 
                    <br/>
                    <span ng-if="isColliding(section)">
                      {{model.collisionDB[section.class_number].length}} collisions
                    </span>
                    <span ng-if="!isColliding(section)">
                      {{section.meeting.start_time}} - {{section.meeting.end_time}} 
                    </span>
                    <br/>
                    {{section.class_number}} 
            

                    </div>
                  </div>
                </span>
              </div>
            </div>

          </div>
        </div>


        <!-- Last Card: User information -->

        <div class="card">
          <div class="card_content" layout vertical>
            <span>
             
              I'll manage the data myself: 
              <input type="checkbox" ng-model="_app.saveToText"> <br/>

              <span ng-show='_app.saveToText'>
                <paper-button 
                  ng-show="_app.saveToText"
                  label="Load or save data" 
                  onclick="toggleDialog('paper-dialog-transition-center')">
                </paper-button>
                <br/>
              </span>

              Save and load to this browser: 
              <input 
                type="checkbox" 
                ng-model="_app.saveToBrowser"
                ng-change="changeSaveToBrowser(_app.saveToBrowser)"
              ><br/>



              I'll login. Store my stuff there: <input type="checkbox" ng-model="_app.saveToLogin" disabled> <br/>

              <form 
                id="login_form" 
                ng-submit="doLogin(credentials)"
                ng-show="_app.saveToLogin"
                novalidate>

                <input type="text" placeholder="NetID" ng-model="credentials.username">
                <input type="password" placeholder="Password" ng-model="credentials.password">
                <input type="submit">
                
              </form>
            </span>
            

            <paper-dialog heading="This is your data." transition="paper-dialog-transition-center">

              <p>To save your calendars just copy it to a safe place. To load previous
                calendars just paste it here. <strong>This will override everything
                currently in the application.</strong></p> <br/>
              
              <textarea
                class="data"
                ng-model="savedata"
                flex></textarea>

              <paper-button label="Cancel" affirmative></paper-button>
              <paper-button 
                label="Done" 
                ng-click="loadData(savedata)"
                affirmative 
                autofocus>
              </paper-button>

            </paper-dialog>

            <paper-button 
              label="Lolcatz" 
              ng-click="checkCollisions()"
              affirmative 
              autofocus>
            </paper-button>
            
            
            <script>
              function toggleDialog(transition) {
                var dialog = document.querySelector('paper-dialog[transition=' + transition + ']');
                dialog.toggle();
              }              
            </script>

          </div>
        </div>

      </div>
    </div>

    <script src="js/YoDB.js"></script>
    <script src="js/tower.js"></script>
    <script src="js/calendar.js"></script>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/bower_components/datejs/build/date.js"></script>
    <script src="/bower_components/spectrajs/spectra.min.js"></script>

    <script src="js/app.js"></script>
    <script src-"js/services.js"></script>
    <script src="js/SearchController.js"></script>
    <script src="js/index.js" defer></script>

  </body>
</html>